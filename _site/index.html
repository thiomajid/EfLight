<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>EfLight &#129718; | EfLight </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="EfLight &#129718; | EfLight ">
      
      
      <link rel="icon" href="favicon.ico">
      <link rel="stylesheet" href="public/docfx.min.css">
      <link rel="stylesheet" href="public/main.css">
      <meta name="docfx:navrel" content="toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="">
      
      
      <meta name="docfx:docurl" content="https://github.com/thiomajid/EfLight/blob/main/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="landing" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="logo.svg" alt="EfLight">
            EfLight
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="eflight-">EfLight 🪶</h1>

<h2 id="goal">Goal</h2>
<p><strong>EfLight</strong>'s goal is to provide a simple API to use EF Core in order to avoid the boilerplate code required for most basic operations with EF Core.</p>
<p>It provides two base classes:</p>
<ul>
<li><p>CrudRepository : which as its name implies, provides most basic operations for CRUD.</p>
</li>
<li><p>PagingAndSortingRepository: it extends <strong>CrudRepository</strong> and provides <strong>pagination</strong> features on top of existing features of CrudRepository.</p>
</li>
</ul>
<h2 id="getting-started">Getting started</h2>
<p>Suppose that we have an entity class named <em>Student</em> and our DbContext is already configured.</p>
<pre><code class="lang-cs">
[Table(&quot;Student&quot;)]
class Student
{
    [Key]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public int Id { get; set; }
    public string? FirstName { get; set; }
    public string? LastName { get; set; }

    [DataType(DataType.Date)]
    public DateTime BirthDate { get; set; }
}

</code></pre>
<p>To interact with the table, just create a <em>repository</em> class which extends whether <strong>CrudRepository</strong> or <strong>PagingAndSortingRepository</strong> (the choice depends on your requirements) with its corresponding interface that will be injected in other classes.</p>
<pre><code class="lang-cs">
public interface IStudentRepository : ICrudRepository&lt;Student, int&gt;
{

}


class StudentRepository : CrudRepository&lt;Student, int&gt;, IStudentRepository
{
    public StudentRepository(YourDbContext context) : base(context)
    {

    }
}

</code></pre>
<p>Then in <code>Program.cs</code>, you can register all of your repositories using:</p>
<pre><code class="lang-cs">
builder.Services.AddEfLight&lt;Program&gt;();

</code></pre>
<h3 id="usage">Usage</h3>
<hr>
<p>All you have to do is to inject it where it is needed. For example:</p>
<pre><code class="lang-cs">
public class StudentService
{
   private readonly IStudentRepository _repository;

   public StudentService(IStudentRepository repository)
   {
        _repository = repository;
   }

   public void CheckIfAllAboveAge(int age)
   {
       bool result =  _repository.ExistsWhere(x =&gt; x.BirthData.Year &gt; age);

       // Your business logic
   }

   public Student? FindByName(string name)
   {
        Student? student;

        Optional&lt;Student&gt; result = _repository.FindWhere(x =&gt; x.LastName == name);

        // Throws the exception if the result is null
        student = result.OrElseThrow(() =&gt; new Exception());

        // Instead of throwing an exception, you can also do
        result.IfNullThen(() =&gt; {
            student = _repository.FindWhere(x =&gt; x.FirstName == name);
        });

        return student;
   }
}

</code></pre>
<h2 id="custom-queries">Custom queries</h2>
<p>You can also provide more features to your repository classes depending on your use cases. Just use an interface defining the contract and provide your own implementation of that use case.</p>
<pre><code class="lang-cs">
public interface IStudentRepository : ICrudRepository&lt;Student, int&gt;
{
    void UpsertById(int studentId);
}

</code></pre>
<p>In the repository class, you'll have:</p>
<pre><code class="lang-cs">
class StudentRepository : CrudRepository&lt;Student, int&gt;, IStudentRepository
{
    public StudentRepository(YourDbContext context) : base(context)
    {

    }

    public void UpsertById(int studentId)
    {
        // Your implementation
    }
}

</code></pre>
<h2 id="lifetime">Lifetime</h2>
<p>When you register your repositories, you can specify the lifetime of your repositories. By default, it is set to <code>ServiceLifetime.Scoped</code>,
but you can provide your default lifetime using:</p>
<pre><code class="lang-cs">
builder.Services.AddEfLight&lt;Program&gt;(options =&gt; {
    options.DefaultLifetime = ServiceLifetime.SingleTransient;
});

</code></pre>
<p>On top of that, you can specify the lifetime of each repository using
<code>RepositoryLifetime</code> attribute on the repository class:</p>
<pre><code class="lang-cs">
[RepositoryLifetime(ServiceLifetime.Scoped)]
public class StudentRepository : CrudRepository&lt;Student, int&gt;, IStudentRepository
{
    public StudentRepository(YourDbContext context) : base(context)
    {

    }
}

</code></pre>
<h2 id="ps">PS</h2>
<p>Want to contribute ? Feel free to open pull requests.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/thiomajid/EfLight/blob/main/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
